<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=US-ASCII" http-equiv="Content-Type">

<title>class PowerController9202 - powercontroller9202-1.0.2 Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/powercontroller9202.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">Object
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-new">::new</a>
    
    <li><a href="#method-i-ensure_on">#ensure_on</a>
    
    <li><a href="#method-i-off">#off</a>
    
    <li><a href="#method-i-off2">#off2</a>
    
    <li><a href="#method-i-on">#on</a>
    
    <li><a href="#method-i-on2">#on2</a>
    
    <li><a href="#method-i-reset_all">#reset_all</a>
    
    <li><a href="#method-i-set_status">#set_status</a>
    
    <li><a href="#method-i-timer_toggle">#timer_toggle</a>
    
    <li><a href="#method-i-timer_toggle_all">#timer_toggle_all</a>
    
    <li><a href="#method-i-to_s">#to_s</a>
    
    <li><a href="#method-i-toggle">#toggle</a>
    
    <li><a href="#method-i-toggle_all">#toggle_all</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./History_txt.html">History</a>
  
    <li class="file"><a href="./Manifest_txt.html">Manifest</a>
  
    <li class="file"><a href="./README_txt.html">README</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./PowerController9202.html">PowerController9202</a>
  
    <li><a href="./PowerController9202Array.html">PowerController9202Array</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class PowerController9202</h1>

  <div id="description" class="description">
    
<p>Aviosys Inc. 9202 IP Power Controller PowerController provides a ruby API
to the web interface</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="PORTMAP4">PORTMAP4
        
        <dd class="description">
        
      
        <dt id="PORTMAP8">PORTMAP8
        
        <dd class="description">
        
      
        <dt id="RELAY_OFF">RELAY_OFF
        
        <dd class="description">
        
      
        <dt id="RELAY_ON">RELAY_ON
        
        <dd class="description">
        
      
        <dt id="VERSION">VERSION
        
        <dd class="description">
        
      
      </dl>
    </section>
    

    
    <!-- Attributes -->
    <section id="attribute-method-details" class="method-section section">
      <h3 class="section-header">Attributes</h3>

      
      <div id="attribute-i-host" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">host</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-password" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">password</span><span
            class="attribute-access-type">[W]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-portmap" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">portmap</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-status" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">status</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-user" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">user</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
    </section><!-- attribute-method-details -->
    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(host, user, password, on_is_off=true, portmap=4 )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>PowerController.new saves the hostname, username and password and returns
the instantiated class</p>

<pre>on_is_off means the relays conduct power in their off state.
  My default is to use the relay off state as power on
  and the relay on state as the power being off (just a wiring decision) 
  This means that a powercontroller failure will leave the devices on,
  which is what I want.
portmap maps the relay number to the web interface's numbering (position on the board)
  I have only have 4 relays installed and they are on Port 0, 2, 5 and 7
  Numbering for SetIO &amp; GetIO use 1,2,3 and 4 as relay numbers, 
  but the web uses the actual relay position on the board.
  PORTMAP maps 1..4 to the actual ports for the web interfaces commands, 
  so Array index 0 is unused</pre>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/powercontroller9202.rb, line 54</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">on_is_off</span>=<span class="ruby-keyword">true</span>, <span class="ruby-identifier">portmap</span>=<span class="ruby-value">4</span> )
  <span class="ruby-ivar">@host</span> = <span class="ruby-identifier">host</span>
  <span class="ruby-ivar">@user</span> = <span class="ruby-identifier">user</span>
  <span class="ruby-ivar">@password</span> = <span class="ruby-identifier">password</span>
  <span class="ruby-ivar">@power_on</span> = <span class="ruby-identifier">on_is_off</span> <span class="ruby-operator">?</span> <span class="ruby-constant">RELAY_OFF</span> <span class="ruby-operator">:</span> <span class="ruby-constant">RELAY_ON</span>
  <span class="ruby-ivar">@power_off</span> = <span class="ruby-identifier">on_is_off</span> <span class="ruby-operator">?</span> <span class="ruby-constant">RELAY_ON</span> <span class="ruby-operator">:</span> <span class="ruby-constant">RELAY_OFF</span>
  <span class="ruby-ivar">@portmap</span> = <span class="ruby-identifier">portmap</span> <span class="ruby-operator">==</span> <span class="ruby-value">4</span> <span class="ruby-operator">?</span> <span class="ruby-constant">PORTMAP4</span> <span class="ruby-operator">:</span> <span class="ruby-constant">PORTMAP8</span>
  <span class="ruby-identifier">set_status</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-ensure_on" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ensure_on</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Ensure_on will fetch each relays state, and turn the relay on, if it is
off. Using SetIO. Note that changes are lost after power cycle.</p>
          

          
          <div class="method-source-code" id="ensure_on-source">
            <pre><span class="ruby-comment"># File lib/powercontroller9202.rb, line 95</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ensure_on</span>
  <span class="ruby-identifier">outlet</span> = []
  <span class="ruby-ivar">@status</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">o</span>,<span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">o</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@power_off</span> 
      <span class="ruby-identifier">outlet</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">outlet</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-comment">#We have relays to alter the state of</span>
    <span class="ruby-identifier">on</span>(<span class="ruby-identifier">outlet</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- ensure_on-source -->
          
        </div>

        

        
      </div><!-- ensure_on-method -->

    
      <div id="method-i-off" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">off</span><span
            class="method-args">(outlet)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>'on' is short hand for tmp_change_state(outlet, @power_off) Using SetIO.
Note that changes are lost after power cycle.</p>
          

          
          <div class="method-source-code" id="off-source">
            <pre><span class="ruby-comment"># File lib/powercontroller9202.rb, line 89</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">off</span>(<span class="ruby-identifier">outlet</span>)
  <span class="ruby-identifier">tmp_change_state</span>(<span class="ruby-identifier">outlet</span>, <span class="ruby-ivar">@power_off</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- off-source -->
          
        </div>

        

        
      </div><!-- off-method -->

    
      <div id="method-i-off2" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">off2</span><span
            class="method-args">(outlet)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>'off2' is short hand for change_state(outlet, PowerController::ON) Uses the
web interface, so unlike 'off', this persists after a device reboot</p>
          

          
          <div class="method-source-code" id="off2-source">
            <pre><span class="ruby-comment"># File lib/powercontroller9202.rb, line 245</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">off2</span>(<span class="ruby-identifier">outlet</span>) <span class="ruby-comment">#Uses the web interfaces, not SetIO</span>
  <span class="ruby-identifier">change_state</span>(<span class="ruby-identifier">outlet</span>, <span class="ruby-ivar">@power_off</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;Off&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;On&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- off2-source -->
          
        </div>

        

        
      </div><!-- off2-method -->

    
      <div id="method-i-on" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">on</span><span
            class="method-args">(outlet)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>'on' is short hand for tmp_change_state(outlet, @power_on) Using SetIO.
Note that changes are lost after power cycle.</p>
          

          
          <div class="method-source-code" id="on-source">
            <pre><span class="ruby-comment"># File lib/powercontroller9202.rb, line 83</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">on</span>(<span class="ruby-identifier">outlet</span>)
  <span class="ruby-identifier">tmp_change_state</span>(<span class="ruby-identifier">outlet</span>, <span class="ruby-ivar">@power_on</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- on-source -->
          
        </div>

        

        
      </div><!-- on-method -->

    
      <div id="method-i-on2" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">on2</span><span
            class="method-args">(outlet)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>'on2' is short hand for change_state(outlet, PowerController::ON) Uses the
web interface, so unlike 'on', this persists after a device reboot</p>
          

          
          <div class="method-source-code" id="on2-source">
            <pre><span class="ruby-comment"># File lib/powercontroller9202.rb, line 239</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">on2</span>(<span class="ruby-identifier">outlet</span>) <span class="ruby-comment">#Uses the web interfaces, not SetIO</span>
  <span class="ruby-identifier">change_state</span>(<span class="ruby-identifier">outlet</span>, <span class="ruby-ivar">@power_on</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;On&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;Off&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- on2-source -->
          
        </div>

        

        
      </div><!-- on2-method -->

    
      <div id="method-i-reset_all" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reset_all</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Reset_all uses the web form reset of each relays to the OFF state This
persists after a device reboot, where the earlier calls do not.</p>
          

          
          <div class="method-source-code" id="reset_all-source">
            <pre><span class="ruby-comment"># File lib/powercontroller9202.rb, line 127</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reset_all</span>
  <span class="ruby-identifier">login</span>
  <span class="ruby-identifier">res</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@host</span>, <span class="ruby-value">80</span>).<span class="ruby-identifier">start</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">http</span><span class="ruby-operator">|</span>

      <span class="ruby-identifier">post</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Post</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">'/tgi/ioControl.tgi'</span>)
      <span class="ruby-comment">#setting post body this way, as set_form_data randomised the order and device expects fixed order.</span>
      <span class="ruby-identifier">post</span>.<span class="ruby-identifier">body</span> = <span class="ruby-string">&quot;PinNo=P6_0&amp;P60=Off&amp;P60_TIMER=0&amp;P60_TIMER_CNTL=Off&amp;&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-string">&quot;PinNo=P6_1&amp;P61=Off&amp;P61_TIMER=0&amp;P61_TIMER_CNTL=Off&amp;&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-string">&quot;PinNo=P6_2&amp;P62=Off&amp;P62_TIMER=0&amp;P62_TIMER_CNTL=Off&amp;&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-string">&quot;PinNo=P6_3&amp;P63=Off&amp;P63_TIMER=0&amp;P63_TIMER_CNTL=Off&amp;&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-string">&quot;PinNo=P6_4&amp;P64=Off&amp;P64_TIMER=0&amp;P64_TIMER_CNTL=Off&amp;&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-string">&quot;PinNo=P6_5&amp;P65=Off&amp;P65_TIMER=0&amp;P65_TIMER_CNTL=Off&amp;&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-string">&quot;PinNo=P6_6&amp;P66=Off&amp;P66_TIMER=0&amp;P66_TIMER_CNTL=Off&amp;&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-string">&quot;PinNo=P6_7&amp;P67=Off&amp;P67_TIMER=0&amp;P67_TIMER_CNTL=Off&amp;&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-string">&quot;Reset=Reset&quot;</span>        
      <span class="ruby-identifier">headers</span> = {
        <span class="ruby-string">'User-Agent'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9) Gecko/2008051206 Firefox/3.0'</span>,
        <span class="ruby-string">'Content-Type'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'application/x-www-form-urlencoded'</span>,
        <span class="ruby-string">'Referer'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;http://#{@host}/ioControl_2e.htm&quot;</span>,
        <span class="ruby-string">'Cookie'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@cookie</span>
      }
        
      <span class="ruby-identifier">response</span> = <span class="ruby-identifier">http</span>.<span class="ruby-identifier">post</span>(<span class="ruby-string">'/tgi/ioControl.tgi'</span>, <span class="ruby-identifier">post</span>.<span class="ruby-identifier">body</span>, <span class="ruby-identifier">headers</span>)
      <span class="ruby-keyword">if</span>(<span class="ruby-identifier">response</span>.<span class="ruby-identifier">code</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">200</span>)
        <span class="ruby-ivar">@status</span>.<span class="ruby-identifier">collect!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-value">0</span> }
      <span class="ruby-keyword">end</span>
      <span class="ruby-comment">#puts response.code</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- reset_all-source -->
          
        </div>

        

        
      </div><!-- reset_all-method -->

    
      <div id="method-i-set_status" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_status</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Fetches the relay states and return as an array of 1's and 0's 1 means the
relay is powered (though you might be using the relay off state as power
on) 0 means the relay is unpowered (though you might be using the relay off
state as power on)</p>
          

          
          <div class="method-source-code" id="set_status-source">
            <pre><span class="ruby-comment"># File lib/powercontroller9202.rb, line 67</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_status</span>
  <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span>.<span class="ruby-identifier">start</span>(<span class="ruby-ivar">@host</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">http</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">response</span> = <span class="ruby-identifier">http</span>.<span class="ruby-identifier">get</span>(<span class="ruby-string">&quot;/GetP6?&quot;</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">code</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">200</span>
        <span class="ruby-comment">#print response.body</span>
        <span class="ruby-ivar">@status</span> = <span class="ruby-constant">PowerController9202Array</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">response</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">scanf</span>(<span class="ruby-string">&quot;&lt;html&gt;P61=%d,P62=%d,P63=%d,P64=%d&lt;/html&gt;&quot;</span>))
      <span class="ruby-keyword">else</span>
        <span class="ruby-comment">#print &quot;Connection failed with error #{response.code}\n&quot;</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Connection failed with error #{response.code}\n&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- set_status-source -->
          
        </div>

        

        
      </div><!-- set_status-method -->

    
      <div id="method-i-timer_toggle" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">timer_toggle</span><span
            class="method-args">(outlet, sleep_time=5)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Timer_toggle uses the web interface's power cycling feature.</p>

<p>I only have 4 relays installed and they are on Port 0, 2, 5 and 7 Numbering
for SetIO &amp; GetIO use 1,2,3 and 4 as relay numbers</p>
          

          
          <div class="method-source-code" id="timer_toggle-source">
            <pre><span class="ruby-comment"># File lib/powercontroller9202.rb, line 200</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">timer_toggle</span>(<span class="ruby-identifier">outlet</span>, <span class="ruby-identifier">sleep_time</span>=<span class="ruby-value">5</span>) <span class="ruby-comment">#</span>
  <span class="ruby-identifier">login</span>
  
  <span class="ruby-identifier">p6</span> = [<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>]
  <span class="ruby-identifier">p6_time</span> = [<span class="ruby-string">&quot;0&quot;</span>, <span class="ruby-string">&quot;0&quot;</span>, <span class="ruby-string">&quot;0&quot;</span>, <span class="ruby-string">&quot;0&quot;</span>,<span class="ruby-string">&quot;0&quot;</span>,<span class="ruby-string">&quot;0&quot;</span>,<span class="ruby-string">&quot;0&quot;</span>,<span class="ruby-string">&quot;0&quot;</span>]
  <span class="ruby-identifier">p6_timer</span> = [<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>]
  <span class="ruby-identifier">p6</span>[<span class="ruby-ivar">@portmap</span>[<span class="ruby-identifier">outlet</span>]] = <span class="ruby-string">&quot;Off&quot;</span>
  <span class="ruby-identifier">p6_time</span>[<span class="ruby-ivar">@portmap</span>[<span class="ruby-identifier">outlet</span>]] = <span class="ruby-node">&quot;#{sleep_time}&quot;</span>
  
  <span class="ruby-identifier">res</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@host</span>, <span class="ruby-value">80</span>).<span class="ruby-identifier">start</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">http</span><span class="ruby-operator">|</span>

      <span class="ruby-identifier">post</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Post</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">'/tgi/ioControl.tgi'</span>)
      <span class="ruby-identifier">post</span>.<span class="ruby-identifier">body</span> = <span class="ruby-node">&quot;PinNo=P6_0&amp;P60=#{p6[0]}&amp;P60_TIMER=#{p6_time[0]}&amp;P60_TIMER_CNTL=#{p6_timer[0]}&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-node">&quot;&amp;PinNo=P6_1&amp;P61=#{p6[1]}&amp;P61_TIMER=#{p6_time[1]}&amp;P61_TIMER_CNTL=#{p6_timer[1]}&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-node">&quot;&amp;PinNo=P6_2&amp;P62=#{p6[2]}&amp;P62_TIMER=#{p6_time[2]}&amp;P62_TIMER_CNTL=#{p6_timer[2]}&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-node">&quot;&amp;PinNo=P6_3&amp;P63=#{p6[3]}&amp;P63_TIMER=#{p6_time[3]}&amp;P63_TIMER_CNTL=#{p6_timer[3]}&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-node">&quot;&amp;PinNo=P6_4&amp;P64=#{p6[4]}&amp;P64_TIMER=#{p6_time[4]}&amp;P64_TIMER_CNTL=#{p6_timer[4]}&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-node">&quot;&amp;PinNo=P6_5&amp;P65=#{p6[5]}&amp;P65_TIMER=#{p6_time[5]}&amp;P65_TIMER_CNTL=#{p6_timer[5]}&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-node">&quot;&amp;PinNo=P6_6&amp;P66=#{p6[6]}&amp;P66_TIMER=#{p6_time[6]}&amp;P66_TIMER_CNTL=#{p6_timer[6]}&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-node">&quot;&amp;PinNo=P6_7&amp;P67=#{p6[7]}&amp;P67_TIMER=#{p6_time[7]}&amp;P67_TIMER_CNTL=#{p6_timer[7]}&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-string">&quot;&amp;Apply=Apply&quot;</span>

      <span class="ruby-comment">#a = post.body.split(/&amp;PinNo/)</span>
      <span class="ruby-comment">#a.each {|x| print &quot;#{x}\n&amp;PinNo&quot; }</span>
      
      <span class="ruby-identifier">headers</span> = {
        <span class="ruby-string">'User-Agent'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9) Gecko/2008051206 Firefox/3.0'</span>,
        <span class="ruby-string">'Content-Type'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'application/x-www-form-urlencoded'</span>,
        <span class="ruby-string">'Referer'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;http://#{@host}/ioControl_2e.htm&quot;</span>,
        <span class="ruby-string">'Cookie'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@cookie</span>
      }
        
      <span class="ruby-identifier">response</span> = <span class="ruby-identifier">http</span>.<span class="ruby-identifier">post</span>(<span class="ruby-string">'/tgi/ioControl.tgi'</span>, <span class="ruby-identifier">post</span>.<span class="ruby-identifier">body</span>, <span class="ruby-identifier">headers</span>)
      <span class="ruby-comment">#puts response.code</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- timer_toggle-source -->
          
        </div>

        

        
      </div><!-- timer_toggle-method -->

    
      <div id="method-i-timer_toggle_all" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">timer_toggle_all</span><span
            class="method-args">(sleep_time=5)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a
href="PowerController9202.html#method-i-timer_toggle_all">#timer_toggle_all</a>
calls the web form to turn off the relays for the time period The earlier
toggle uses the SetIO call, with an, OFF, sleep, then ON call.</p>
          

          
          <div class="method-source-code" id="timer_toggle_all-source">
            <pre><span class="ruby-comment"># File lib/powercontroller9202.rb, line 159</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">timer_toggle_all</span>(<span class="ruby-identifier">sleep_time</span>=<span class="ruby-value">5</span>) 
  <span class="ruby-identifier">login</span>
  <span class="ruby-identifier">p6</span> = [<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>]
  <span class="ruby-identifier">p6_time</span> = [<span class="ruby-string">&quot;0&quot;</span>, <span class="ruby-string">&quot;0&quot;</span>, <span class="ruby-string">&quot;0&quot;</span>, <span class="ruby-string">&quot;0&quot;</span>,<span class="ruby-string">&quot;0&quot;</span>,<span class="ruby-string">&quot;0&quot;</span>,<span class="ruby-string">&quot;0&quot;</span>,<span class="ruby-string">&quot;0&quot;</span>]
  <span class="ruby-identifier">p6_timer</span> = [<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>,<span class="ruby-string">&quot;On&quot;</span>]
  <span class="ruby-ivar">@portmap</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pm</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">p6</span>[<span class="ruby-identifier">pm</span>] = <span class="ruby-ivar">@power_on</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Off&quot;</span>
    <span class="ruby-identifier">p6_time</span>[<span class="ruby-identifier">pm</span>] = <span class="ruby-node">&quot;#{sleep_time}&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">res</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@host</span>, <span class="ruby-value">80</span>).<span class="ruby-identifier">start</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">http</span><span class="ruby-operator">|</span>

      <span class="ruby-identifier">post</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Post</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">'/tgi/ioControl.tgi'</span>)
      <span class="ruby-identifier">post</span>.<span class="ruby-identifier">body</span> = <span class="ruby-node">&quot;PinNo=P6_0&amp;P60=#{p6[0]}&amp;P60_TIMER=#{p6_time[0]}&amp;P60_TIMER_CNTL=#{p6_timer[0]}&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-node">&quot;&amp;PinNo=P6_1&amp;P61=#{p6[1]}&amp;P61_TIMER=#{p6_time[1]}&amp;P61_TIMER_CNTL=#{p6_timer[1]}&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-node">&quot;&amp;PinNo=P6_2&amp;P62=#{p6[2]}&amp;P62_TIMER=#{p6_time[2]}&amp;P62_TIMER_CNTL=#{p6_timer[2]}&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-node">&quot;&amp;PinNo=P6_3&amp;P63=#{p6[3]}&amp;P63_TIMER=#{p6_time[3]}&amp;P63_TIMER_CNTL=#{p6_timer[3]}&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-node">&quot;&amp;PinNo=P6_4&amp;P64=#{p6[4]}&amp;P64_TIMER=#{p6_time[4]}&amp;P64_TIMER_CNTL=#{p6_timer[4]}&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-node">&quot;&amp;PinNo=P6_5&amp;P65=#{p6[5]}&amp;P65_TIMER=#{p6_time[5]}&amp;P65_TIMER_CNTL=#{p6_timer[5]}&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-node">&quot;&amp;PinNo=P6_6&amp;P66=#{p6[6]}&amp;P66_TIMER=#{p6_time[6]}&amp;P66_TIMER_CNTL=#{p6_timer[6]}&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-node">&quot;&amp;PinNo=P6_7&amp;P67=#{p6[7]}&amp;P67_TIMER=#{p6_time[7]}&amp;P67_TIMER_CNTL=#{p6_timer[7]}&quot;</span> <span class="ruby-operator">+</span>
                  <span class="ruby-string">&quot;&amp;Apply=Apply&quot;</span>
     <span class="ruby-comment"># print post.body</span>
      
      <span class="ruby-identifier">headers</span> = {
        <span class="ruby-string">'User-Agent'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9) Gecko/2008051206 Firefox/3.0'</span>,
        <span class="ruby-string">'Content-Type'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'application/x-www-form-urlencoded'</span>,
        <span class="ruby-string">'Referer'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;http://#{@host}/ioControl_2e.htm&quot;</span>,
        <span class="ruby-string">'Cookie'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@cookie</span>
      }
        
      <span class="ruby-identifier">response</span> = <span class="ruby-identifier">http</span>.<span class="ruby-identifier">post</span>(<span class="ruby-string">'/tgi/ioControl.tgi'</span>, <span class="ruby-identifier">post</span>.<span class="ruby-identifier">body</span>, <span class="ruby-identifier">headers</span>)
      <span class="ruby-comment">#puts response.code</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- timer_toggle_all-source -->
          
        </div>

        

        
      </div><!-- timer_toggle_all-method -->

    
      <div id="method-i-to_s" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">to_s</span><span
            class="method-args">(port_names = [nil,nil,nil,nil ])</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Return a status string, with named ports specified in the port_names array.</p>
          

          
          <div class="method-source-code" id="to_s-source">
            <pre><span class="ruby-comment"># File lib/powercontroller9202.rb, line 250</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">port_names</span> = [<span class="ruby-keyword">nil</span>,<span class="ruby-keyword">nil</span>,<span class="ruby-keyword">nil</span>,<span class="ruby-keyword">nil</span> ])
  <span class="ruby-ivar">@status</span>.<span class="ruby-identifier">inject_with_index</span>(<span class="ruby-string">&quot;&quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span>,<span class="ruby-identifier">x</span>,<span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;Port #{i+1}=#{x==0 ? 'On' : 'Off'} #{if port_names[i] then port_names[i] end}\n&quot;</span> } 
<span class="ruby-keyword">end</span></pre>
          </div><!-- to_s-source -->
          
        </div>

        

        
      </div><!-- to_s-method -->

    
      <div id="method-i-toggle" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">toggle</span><span
            class="method-args">(outlet, sleep_time=5)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>toggle turns a relay off, then back on again, so the device is power
cycled. If the outlet argument is an array, all relays specified in the
array are power cycled. The time the relay is off is defined by the
argument sleep_time (defoult of 5 seconds)</p>
          

          
          <div class="method-source-code" id="toggle-source">
            <pre><span class="ruby-comment"># File lib/powercontroller9202.rb, line 110</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">toggle</span>(<span class="ruby-identifier">outlet</span>, <span class="ruby-identifier">sleep_time</span>=<span class="ruby-value">5</span>)
  <span class="ruby-identifier">off</span>(<span class="ruby-identifier">outlet</span>)
  <span class="ruby-identifier">sleep</span> <span class="ruby-identifier">sleep_time</span>
  <span class="ruby-identifier">on</span>(<span class="ruby-identifier">outlet</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- toggle-source -->
          
        </div>

        

        
      </div><!-- toggle-method -->

    
      <div id="method-i-toggle_all" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">toggle_all</span><span
            class="method-args">(sleep_time=5)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Toggle_all power cycles all the relays. The time the relay is off is
defined by the argument sleep_time (defoult of 5 seconds)</p>
          

          
          <div class="method-source-code" id="toggle_all-source">
            <pre><span class="ruby-comment"># File lib/powercontroller9202.rb, line 118</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">toggle_all</span>(<span class="ruby-identifier">sleep_time</span>=<span class="ruby-value">5</span>)
  <span class="ruby-identifier">outlet</span> = []
  <span class="ruby-ivar">@portmap</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">each_with_index</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span>,<span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">outlet</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">i</span><span class="ruby-operator">+</span><span class="ruby-value">1</span> }
  <span class="ruby-identifier">toggle</span>(<span class="ruby-identifier">outlet</span>, <span class="ruby-identifier">sleep_time</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- toggle_all-source -->
          
        </div>

        

        
      </div><!-- toggle_all-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

